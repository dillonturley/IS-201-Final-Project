<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Web App</title>
  <style>
    :root{
      --bg:#0b0d12;
      --panel: rgba(15,19,32,.78);
      --line: rgba(232,236,246,.12);
      --text:#e8ecf6;
      --muted:#aab2c6;
      --accent:#a6b7ff;
      --accent2:#77f2d2;
      color-scheme: dark;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background:
        radial-gradient(1200px 650px at 20% 10%, rgba(166,183,255,.10), transparent 62%),
        radial-gradient(1000px 620px at 85% 12%, rgba(119,242,210,.08), transparent 60%),
        var(--bg);
    }
    a{ color: inherit; text-decoration:none; }
    a:hover{ text-decoration: underline; text-underline-offset: 3px; }

    .top{
      position: sticky;
      top:0;
      backdrop-filter: blur(10px);
      background: rgba(11,13,18,.72);
      border-bottom: 1px solid var(--line);
      z-index: 2;
    }
    .topInner{
      max-width: 1180px;
      margin: 0 auto;
      padding: 12px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }
    .title{
      font-weight: 800;
      letter-spacing:.2px;
    }
    .nav{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .nav a{
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(232,236,246,.10);
      background: rgba(15,19,32,.50);
    }

    .wrap{
      max-width: 1180px;
      margin: 0 auto;
      padding: 16px;
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
    }

    .card{
      border: 1px solid var(--line);
      background: var(--panel);
      border-radius: 18px;
      overflow:hidden;
    }
    .canvasWrap{
      position: relative;
      min-height: 520px;
      background:
        radial-gradient(900px 320px at 22% 0%, rgba(166,183,255,.08), transparent 60%),
        radial-gradient(900px 320px at 82% 0%, rgba(119,242,210,.06), transparent 60%);
    }
    canvas{
      width: 100%;
      height: 520px;
      display:block;
    }
    .hud{
      position:absolute;
      left:12px;
      top:12px;
      right:12px;
      display:flex;
      justify-content:space-between;
      gap: 12px;
      pointer-events:none;
    }
    .hudChip{
      pointer-events:none;
      font-family: ui-monospace, Menlo, Consolas, monospace;
      font-size: 12px;
      color: rgba(232,236,246,.85);
      border: 1px solid rgba(232,236,246,.12);
      background: rgba(12,16,27,.55);
      padding: 8px 10px;
      border-radius: 999px;
      white-space:nowrap;
    }

    .side{
      padding: 14px;
      display:grid;
      gap: 12px;
    }
    .h2{
      margin: 0;
      font-size: 16px;
      font-weight: 800;
    }
    .p{
      margin: 0;
      color: var(--muted);
      line-height: 1.55;
      font-size: 14px;
    }
    .controls{
      display:grid;
      gap: 10px;
      margin-top: 6px;
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }
    .btn{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(232,236,246,.14);
      background: rgba(15,19,32,.50);
      color: var(--text);
      cursor:pointer;
      font-weight: 700;
    }
    .btn:hover{ filter: brightness(1.08); }
    .toggle{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(232,236,246,.14);
      background: rgba(15,19,32,.50);
      cursor:pointer;
      user-select:none;
    }
    .toggleDot{
      width: 10px; height: 10px; border-radius: 999px;
      background: linear-gradient(140deg, rgba(166,183,255,.9), rgba(119,242,210,.7));
      box-shadow: 0 0 0 1px rgba(255,255,255,.16) inset;
    }
    .kv{
      border: 1px solid rgba(232,236,246,.10);
      border-radius: 14px;
      padding: 12px;
      background: rgba(12,16,27,.45);
      display:grid;
      gap: 8px;
    }
    .k{ color: rgba(170,178,198,.95); font-size: 12px; }
    .v{
      font-family: ui-monospace, Menlo, Consolas, monospace;
      font-weight: 800;
      letter-spacing:.2px;
    }

    .foot{
      max-width: 1180px;
      margin: 0 auto;
      padding: 0 16px 20px;
      color: rgba(170,178,198,.9);
      font-size: 12px;
    }
  </style>
</head>
<body>
  <header class="top">
    <div class="topInner">
      <div class="title">Exploration App</div>
      <nav class="nav" aria-label="Navigation">
        <a href="scratch.html">Back to Scratch</a>
        <a href="index.html">Home</a>
        <a href="projects.html">Projects</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="card canvasWrap" aria-label="Interactive canvas area">
      <div class="hud" aria-hidden="true">
        <div class="hudChip" id="chipA">—</div>
        <div class="hudChip" id="chipB">—</div>
      </div>
      <canvas id="c" width="1200" height="520"></canvas>
    </section>

    <aside class="card side" aria-label="Controls">
      <div>
        <h2 class="h2">Controls</h2>
        <p class="p">No instructions are shown on-canvas. Interaction is discovered through input.</p>
      </div>

      <div class="controls">
        <div class="row">
          <button class="btn" id="reset" type="button">Reset</button>
          <button class="btn" id="calm" type="button">Stabilize</button>
        </div>

        <div class="toggle" id="invert" role="button" tabindex="0" aria-label="Toggle field inversion">
          <span class="toggleDot" aria-hidden="true"></span>
          <span>Invert field</span>
        </div>

        <div class="kv">
          <div class="k">Particles</div>
          <div class="v" id="particles">—</div>
          <div class="k">Energy</div>
          <div class="v" id="energy">—</div>
          <div class="k">Mode</div>
          <div class="v" id="mode">—</div>
        </div>

        <p class="p">
          Navigation:
          <a href="scratch.html">scratch.html</a>
        </p>
      </div>
    </aside>
  </main>

  <footer class="foot">
    This single-page app includes HTML + CSS + JS together and is linked from scratch.html.
  </footer>

  <script>
    (function(){
      const canvas = document.getElementById("c");
      const ctx = canvas.getContext("2d", { alpha: true });

      const chipA = document.getElementById("chipA");
      const chipB = document.getElementById("chipB");
      const outParticles = document.getElementById("particles");
      const outEnergy = document.getElementById("energy");
      const outMode = document.getElementById("mode");

      const resetBtn = document.getElementById("reset");
      const calmBtn = document.getElementById("calm");
      const invertBtn = document.getElementById("invert");

      const DPR = Math.min(2, window.devicePixelRatio || 1);

      function resize(){
        const rect = canvas.getBoundingClientRect();
        const w = Math.max(680, Math.floor(rect.width));
        const h = Math.floor(rect.height);
        canvas.width = Math.floor(w * DPR);
        canvas.height = Math.floor(h * DPR);
        canvas.dataset.w = String(w);
        canvas.dataset.h = String(h);
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      }
      resize();
      window.addEventListener("resize", resize);

      const W = () => Number(canvas.dataset.w || "1200");
      const H = () => Number(canvas.dataset.h || "520");

      const sys = {
        t: performance.now(),
        energy: 0,
        invert: false,
        mode: "idle",
        interactions: 0,
        pointer: { x: W()/2, y: H()/2, vx: 0, vy: 0, speed: 0, down: false },
        field: { stamps: [], stampMax: 26 },
        particles: [],
      };

      function seed(n){
        sys.particles = Array.from({length:n}, () => ({
          x: Math.random()*W(),
          y: Math.random()*H(),
          vx: (Math.random()-0.5)*0.9,
          vy: (Math.random()-0.5)*0.9,
          m: 0.6 + Math.random()*1.6,
          a: 0.35 + Math.random()*0.65,
          hue: Math.random()
        }));
      }
      seed(280);

      function stamp(x,y,strength){
        sys.field.stamps.push({
          x, y,
          s: strength,
          born: performance.now(),
          life: 4200 + Math.random()*2600
        });
        while(sys.field.stamps.length > sys.field.stampMax) sys.field.stamps.shift();
      }

      // Pointer tracking (non-obvious: speed is primary signal)
      let last = { x: 0, y: 0, t: performance.now() };
      canvas.addEventListener("pointermove", (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        const t = performance.now();
        const dt = Math.max(8, t - last.t);
        const dx = x - last.x;
        const dy = y - last.y;

        sys.pointer.vx = dx / dt;
        sys.pointer.vy = dy / dt;
        sys.pointer.speed = Math.min(3.2, Math.hypot(sys.pointer.vx, sys.pointer.vy));
        sys.pointer.x = x;
        sys.pointer.y = y;

        // drawing only while down, but the stamp strength is velocity-weighted
        if (sys.pointer.down) {
          const s = 0.55 + sys.pointer.speed * 1.25;
          stamp(x, y, s);
          sys.interactions++;
        }

        last = { x, y, t };
      }, { passive:true });

      canvas.addEventListener("pointerdown", (e) => {
        sys.pointer.down = true;
        canvas.setPointerCapture(e.pointerId);
        stamp(sys.pointer.x, sys.pointer.y, 1.4);
        sys.interactions++;
      });

      canvas.addEventListener("pointerup", () => {
        sys.pointer.down = false;
      });

      // Hidden: double-click toggles invert as well (in addition to button)
      canvas.addEventListener("dblclick", () => {
        sys.invert = !sys.invert;
        sys.interactions += 2;
      });

      // Hidden: hold Space to “freeze” and let energy bleed out
      let freezing = false;
      window.addEventListener("keydown", (e) => {
        if (e.code === "Space") freezing = true;
      });
      window.addEventListener("keyup", (e) => {
        if (e.code === "Space") freezing = false;
      });

      // Controls
      function stabilize(){
        for (const p of sys.particles){
          p.vx *= 0.25;
          p.vy *= 0.25;
        }
        sys.energy *= 0.35;
      }
      resetBtn.addEventListener("click", () => { seed(280); sys.field.stamps = []; sys.energy = 0; sys.interactions++; });
      calmBtn.addEventListener("click", () => { stabilize(); sys.interactions++; });

      function toggleInvert(){
        sys.invert = !sys.invert;
        sys.interactions++;
      }
      invertBtn.addEventListener("click", toggleInvert);
      invertBtn.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") toggleInvert();
      });

      // Field evaluation: stamps create a rotating force; strength fades over time
      function fieldAt(x,y,t){
        let fx = 0, fy = 0;
        const inv = sys.invert ? -1 : 1;

        for (const s of sys.field.stamps){
          const age = (t - s.born);
          if (age > s.life) continue;

          const k = (1 - age / s.life);
          const dx = x - s.x;
          const dy = y - s.y;
          const d2 = dx*dx + dy*dy + 120;

          // swirl magnitude changes slowly over time (system evolves)
          const swirl = (0.9 + 0.7 * Math.sin((t + s.born) / 1800)) * inv;

          const mag = (s.s * k) / d2;
          // swirl field (perpendicular)
          fx += (-dy) * mag * swirl;
          fy += ( dx) * mag * swirl;

          // faint attract/repel tied to pointer speed (non-obvious)
          const pull = (0.15 + sys.pointer.speed * 0.22) * inv;
          fx += (-dx) * mag * pull * 0.2;
          fy += (-dy) * mag * pull * 0.2;
        }
        return { fx, fy };
      }

      // Time-based system behavior: adapt particle count based on interaction rhythm
      let lastAdapt = performance.now();
      function adapt(t){
        if (t - lastAdapt < 1400) return;
        lastAdapt = t;

        const target =
          sys.pointer.speed > 1.4 ? 360 :
          sys.pointer.speed > 0.7 ? 320 : 280;

        const cur = sys.particles.length;
        if (cur < target) {
          const add = Math.min(18, target - cur);
          for (let i=0;i<add;i++){
            sys.particles.push({
              x: Math.random()*W(),
              y: Math.random()*H(),
              vx: (Math.random()-0.5)*0.8,
              vy: (Math.random()-0.5)*0.8,
              m: 0.6 + Math.random()*1.6,
              a: 0.35 + Math.random()*0.65,
              hue: Math.random()
            });
          }
        } else if (cur > target) {
          sys.particles.splice(0, Math.min(18, cur - target));
        }
      }

      function draw(t){
        const w = W(), h = H();
        const dt = Math.min(34, t - sys.t);
        sys.t = t;

        adapt(t);

        // energy responds to speed; decays; freezes drain it
        sys.energy = Math.min(1.6, Math.max(0, sys.energy * 0.965 + sys.pointer.speed * 0.065));
        if (freezing) sys.energy *= 0.92;

        const idleFor = t - last.t;
        sys.mode =
          freezing ? "frozen" :
          idleFor > 1200 ? "idle" :
          sys.pointer.down ? "marking" :
          sys.pointer.speed > 1.1 ? "active" : "tracking";

        // background
        ctx.clearRect(0,0,w,h);
        ctx.fillStyle = "rgba(0,0,0,0)";
        ctx.fillRect(0,0,w,h);

        // faint lattice (stable; professional)
        ctx.globalAlpha = 0.22;
        ctx.strokeStyle = "rgba(232,236,246,0.10)";
        ctx.lineWidth = 1;
        for (let x=0;x<=w;x+=48){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,h); ctx.stroke(); }
        for (let y=0;y<=h;y+=48){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke(); }
        ctx.globalAlpha = 1;

        // expire old stamps
        sys.field.stamps = sys.field.stamps.filter(s => (t - s.born) <= s.life);

        // particles
        for (const p of sys.particles){
          const f = fieldAt(p.x, p.y, t);
          const accel = (0.75 + sys.energy) / (p.m);

          if (!freezing){
            p.vx += f.fx * accel * (dt/16) * 220;
            p.vy += f.fy * accel * (dt/16) * 220;
          }

          // gentle damping + boundary reflect
          const damp = freezing ? 0.90 : 0.95;
          p.vx *= damp;
          p.vy *= damp;

          p.x += p.vx * (dt/16) * 1.15;
          p.y += p.vy * (dt/16) * 1.15;

          if (p.x < 6){ p.x = 6; p.vx *= -0.7; }
          if (p.x > w-6){ p.x = w-6; p.vx *= -0.7; }
          if (p.y < 6){ p.y = 6; p.vy *= -0.7; }
          if (p.y > h-6){ p.y = h-6; p.vy *= -0.7; }
        }

        // render: trails depend on energy; still subtle
        ctx.lineWidth = 1;
        const e = Math.min(1.0, sys.energy);
        for (const p of sys.particles){
          ctx.strokeStyle = `rgba(166,183,255,${0.04 + 0.06*e})`;
          ctx.beginPath();
          ctx.moveTo(p.x, p.y);
          ctx.lineTo(p.x - p.vx * 10, p.y - p.vy * 10);
          ctx.stroke();

          ctx.fillStyle = `rgba(232,236,246,${0.14 + 0.18*e})`;
          ctx.beginPath();
          ctx.arc(p.x, p.y, 1.2, 0, Math.PI*2);
          ctx.fill();
        }

        // HUD (quiet)
        if (chipA) chipA.textContent = `${sys.mode} • ${sys.invert ? "inverted" : "normal"}`;
        if (chipB) chipB.textContent = `${Math.round(sys.pointer.speed*100)} • ${sys.field.stamps.length} marks`;
        if (outParticles) outParticles.textContent = String(sys.particles.length);
        if (outEnergy) outEnergy.textContent = sys.energy.toFixed(2);
        if (outMode) outMode.textContent = sys.mode;

        requestAnimationFrame(draw);
      }
      requestAnimationFrame(draw);
    })();
  </script>
</body>
</html>
